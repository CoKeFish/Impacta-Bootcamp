{
  "meta": {
    "project": "CoTravel",
    "date": "2026-02-06",
    "prepared_by": "Software Development Manager"
  },
  "product_overview": "CoTravel is a web platform for group travel budgeting that integrates off-chain coordination with on-chain escrow using Stellar/Soroban smart contracts. It allows trip organizers to create transparent budgets, collect contributions securely, and enforce fair penalties automatically, ensuring a trustless and equitable group travel experience.",
  "core_goals": [
    "Enable users to create and manage group travel budgets with clear rules and penalties.",
    "Securely hold and manage contributions in a blockchain-based escrow contract rather than individual accounts.",
    "Provide transparent tracking of contributions and participant status.",
    "Offer robust authentication using Stellar wallet signatures and JWTs.",
    "Allow organizers to manage the lifecycle of trips including fund release and cancellation with full refunds.",
    "Ensure a user-friendly interface with accessible trip browsing and participation flows.",
    "Maintain high security and performance standards with reliable backend services and blockchain integration."
  ],
  "key_features": [
    "Wallet based authentication via Freighter and challenge-response with JWT issuance.",
    "Trip creation with configurable parameters like target amount, minimum participants, penalties, and deadlines.",
    "Dashboard listing all trips with real-time progress, participant counts, and statuses.",
    "Detailed trip pages showing budget progress, participant contributions, on-chain contract linkage, and controls for organizers.",
    "Participant workflow including joining trips, contributing funds, and withdrawing with penalties enforced on-chain.",
    "Image upload and management stored in MinIO with associations to trips.",
    "User profile displaying wallet info, organized and participated trips.",
    "Robust backend API with full CRUD for trips, participant management, user management, and blockchain transaction recording.",
    "Integration with Soroban smart contracts for escrow, including signed transaction submissions and state synchronization.",
    "Responsive layout with header, footer, and navigation optimized for desktop and mobile."
  ],
  "user_flow_summary": [
    "User visits landing page and browses trips without authentication.",
    "User connects a Stellar wallet using Freighter to authenticate.",
    "Authenticated user creates a new trip draft specifying budget and rules.",
    "User explores the dashboard to view all trips and selects a trip for details.",
    "Participants join a trip and contribute funds by signing transactions via their wallet.",
    "Organizers link the trip to the on-chain escrow contract by submitting a signed transaction.",
    "Organizers can release funds to confirm a trip or cancel it to trigger refunds, both requiring signed transactions.",
    "Participants can withdraw funds with penalties enforced automatically on-chain.",
    "Users can upload images associated with trips to enhance trip presentation.",
    "Users access their profile to view personal info and trips they are involved with."
  ],
  "validation_criteria": [
    "Users must authenticate successfully using Stellar wallet challenge-response flow and receive JWT token.",
    "Trip creation enforces required fields and proper validation, only available to authenticated users.",
    "Trip lists and detail views correctly display both off-chain data and on-chain contract state.",
    "Only organizers can perform sensitive operations like linking contracts, releasing funds, or cancelling trips, verified by middleware.",
    "Participant contributions and withdrawals update on-chain state and reflect accurately in the UI.",
    "Image uploads succeed with correct storage in MinIO and proper metadata in the database.",
    "Frontend routes respect authentication status and restrict access accordingly.",
    "Backend health endpoint confirms connectivity to PostgreSQL and MinIO storage.",
    "All backend APIs return expected status codes and data shapes, validated by integration tests.",
    "Soroban transaction submissions respond within 30 seconds and update trip lifecycle state appropriately."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "React 19",
      "Vite 6",
      "Tailwind CSS 3",
      "shadcn/ui",
      "React Router 7",
      "TanStack Query 5",
      "Zustand 5",
      "@stellar/freighter-api",
      "@stellar/stellar-sdk",
      "Node.js",
      "Express.js",
      "PostgreSQL 16",
      "MinIO (S3-compatible)",
      "Soroban (Stellar smart contracts)",
      "Jest",
      "Supertest",
      "Docker Compose"
    ],
    "features": [
      {
        "name": "Landing Page",
        "description": "Public landing page with hero section, feature highlights (group coordination, on-chain escrow, fair penalties), and CTAs to browse or create trips.",
        "files": [
          "frontend/src/pages/Landing.tsx"
        ]
      },
      {
        "name": "Trip Dashboard",
        "description": "Lists all trips as cards with progress bars showing collected vs target XLM, participant count, status badges, and organizer info. Uses TanStack Query for data fetching.",
        "files": [
          "frontend/src/pages/Dashboard.tsx"
        ]
      },
      {
        "name": "Trip Detail",
        "description": "Displays trip details including budget stats (collected/target with progress bar), participant count vs minimum, deadline, penalty percentage, and a list of participants with their contributions.",
        "files": [
          "frontend/src/pages/TripDetail.tsx"
        ]
      },
      {
        "name": "Create Trip",
        "description": "Authenticated form to create a new trip draft with fields: name, description, target amount (XLM), min participants, penalty percent, and deadline. Requires wallet connection.",
        "files": [
          "frontend/src/pages/CreateTrip.tsx"
        ]
      },
      {
        "name": "User Profile",
        "description": "Shows authenticated user's wallet address, username, join date, and lists trips they organize and participate in.",
        "files": [
          "frontend/src/pages/Profile.tsx"
        ]
      },
      {
        "name": "Wallet Connection (Freighter)",
        "description": "Connect/disconnect Stellar wallet via Freighter browser extension. Shows truncated address when connected, loading and error states.",
        "files": [
          "frontend/src/components/wallet/ConnectButton.tsx",
          "frontend/src/hooks/useAuth.ts",
          "frontend/src/stores/walletStore.ts"
        ]
      },
      {
        "name": "Authentication (Challenge-Response)",
        "description": "Wallet-based auth flow: request challenge from backend, sign with Freighter, submit signature to get JWT. Token persisted in localStorage and Zustand store.",
        "files": [
          "frontend/src/hooks/useAuth.ts",
          "frontend/src/stores/walletStore.ts",
          "backend/src/controllers/authController.js",
          "backend/src/routes/auth.js",
          "backend/src/middleware/auth.js"
        ]
      },
      {
        "name": "Layout (Header, Footer, Navigation)",
        "description": "Responsive layout with sticky header containing logo, navigation links (Trips, Create, Profile), and wallet connect button. Footer with project info.",
        "files": [
          "frontend/src/components/layout/Layout.tsx",
          "frontend/src/components/layout/Header.tsx",
          "frontend/src/components/layout/Footer.tsx"
        ]
      },
      {
        "name": "API Client",
        "description": "HTTP client service with typed functions for all 18 backend endpoints. Automatically attaches JWT from localStorage. Handles JSON and FormData requests.",
        "files": [
          "frontend/src/services/api.ts"
        ]
      },
      {
        "name": "UI Components (shadcn/ui)",
        "description": "Reusable UI components: Button (with asChild/Slot support), Card (Header/Title/Description/Content/Footer), Badge (with status variants including success/warning).",
        "files": [
          "frontend/src/components/ui/button.tsx",
          "frontend/src/components/ui/card.tsx",
          "frontend/src/components/ui/badge.tsx"
        ]
      },
      {
        "name": "Backend Health Check",
        "description": "GET /health endpoint that verifies connectivity to both PostgreSQL (SELECT 1) and MinIO (listBuckets). Returns status for each service.",
        "files": [
          "backend/src/routes/health.js"
        ]
      },
      {
        "name": "User Management",
        "description": "Create users with wallet address, lookup by wallet. Used internally by auth flow and directly via API.",
        "files": [
          "backend/src/controllers/usersController.js",
          "backend/src/models/userModel.js",
          "backend/src/routes/users.js"
        ]
      },
      {
        "name": "Trip Management",
        "description": "Full CRUD for trips: create draft, list all, get by ID (with on-chain state refresh), link to Soroban contract, release funds, cancel trip. Organizer-only operations enforced via middleware.",
        "files": [
          "backend/src/controllers/tripsController.js",
          "backend/src/models/tripModel.js",
          "backend/src/routes/trips.js"
        ]
      },
      {
        "name": "Participant Management",
        "description": "Join trips, record contributions (submit signed XDR to Soroban), record withdrawals, list participants. Auto-join on first contribution. Syncs on-chain state after operations.",
        "files": [
          "backend/src/controllers/participantsController.js",
          "backend/src/models/participantModel.js"
        ]
      },
      {
        "name": "Soroban Integration",
        "description": "Service for interacting with the multi-escrow Soroban smart contract. Read-only queries via simulation (get_trip, get_state, get_balance, get_participants). Write operations via signed XDR submission with 30s polling for confirmation.",
        "files": [
          "backend/src/services/sorobanService.js",
          "backend/src/config/soroban.js"
        ]
      },
      {
        "name": "Image Management",
        "description": "Upload images to MinIO object storage with metadata in PostgreSQL. Stream images back to client. List all images.",
        "files": [
          "backend/src/controllers/imagesController.js",
          "backend/src/models/imageModel.js",
          "backend/src/routes/images.js",
          "backend/src/config/minio.js"
        ]
      },
      {
        "name": "Transaction Registry",
        "description": "Records blockchain transactions (create_trip, contribution, withdrawal, release, cancel) with tx_hash, ledger sequence, and event data for off-chain indexing.",
        "files": [
          "backend/src/models/transactionModel.js"
        ]
      },
      {
        "name": "Database Schema",
        "description": "PostgreSQL schema with 7 tables: users, trips, trip_participants, transactions, partners, trip_offers, images. Includes indexes for frequent queries and sample data.",
        "files": [
          "database/init.sql"
        ]
      }
    ]
  }
}
