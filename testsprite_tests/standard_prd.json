{
  "meta": {
    "project": "CoTravel Group Payment Platform",
    "date": "2026-02-06",
    "prepared_by": "Software Development Manager"
  },
  "product_overview": "CoTravel is a blockchain-based group trip payment platform that simplifies organizing shared budgets, collecting contributions, and automating escrow payments via Soroban smart contracts on the Stellar network. It provides transparent workflows for trip organizers and participants with on-chain enforced rules, penalties, and automated payouts to service providers.",
  "core_goals": [
    "Enable secure and trustless group trip budget management using blockchain escrow.",
    "Simplify the creation, funding, and management of group invoices with multiple recipients.",
    "Provide real-time tracking of invoice payment progress and participant contributions.",
    "Enforce penalty rules fairly when participants withdraw after modifications.",
    "Allow immediate and automatic release of funds when group targets are met and confirmed.",
    "Support CRUD operations for businesses and services associated with group payments.",
    "Implement role-based access control including user and admin roles for platform management.",
    "Provide seamless wallet authentication using Stellar's Freighter and SEP-0053 challenge-response.",
    "Offer an admin dashboard for oversight of users, businesses, and invoices.",
    "Maintain a scalable, robust backend with PostgreSQL caching and Soroban smart contract integration."
  ],
  "key_features": [
    "Wallet authentication via Stellar Freighter with auto-login for development convenience.",
    "Invoice Dashboard listing all invoices with status badges and navigation to details.",
    "Invoice creation form supporting group invoices with customizable items and business services.",
    "Invoice detail page with progress tracking, participant management, and on-chain action integration.",
    "Soroban transaction builder that simulates and assembles blockchain transactions, supporting mock mode for development.",
    "Public-facing Service Catalog displaying active services from registered businesses with search filtering.",
    "Business and Service Management with full CRUD capabilities for authenticated owners.",
    "User Profile viewing wallet address, username, role, and registration date.",
    "Admin dashboard accessible only to admins providing user role management, business and invoice oversight, and platform statistics.",
    "Responsive layout and navigation with dynamic header links based on authentication state and roles."
  ],
  "user_flow_summary": [
    "User authenticates by connecting wallet via Freighter, signs a backend challenge, and receives JWT for session.",
    "Authenticated user creates a group invoice by filling a form with participants and line items from services or custom entries.",
    "Invoice linked on-chain by building and signing a Soroban transaction to create a pool escrow representing the invoice.",
    "Participants join the invoice funding pool, contribute funds, and may withdraw before completion adhering to penalty rules.",
    "Organizer can modify invoice items requiring participant consent and withdrawal opt-outs without penalty.",
    "Participants confirm readiness to release funds; if all confirm or auto-release enabled, funds are distributed on-chain automatically.",
    "Invoice can be cancelled by organizer with full refund and penalty return mechanism triggered via smart contract.",
    "Authenticated users manage their registered businesses and services through dedicated CRUD views.",
    "Admin user accesses a protected admin panel to monitor and control users, businesses, and invoices across the platform.",
    "Public visitors browse active services and business profiles without authentication."
  ],
  "validation_criteria": [
    "User authentication enforces SEP-0053 challenge-response and JWT authorization with 24-hour tokens.",
    "Invoice creation validates required fields: name, future deadline, items with descriptions and positive amounts.",
    "On-chain actions including create, contribute, withdraw, confirm, release, cancel, and claim deadline are correctly built, simulated, signed, and submitted with proper blockchain state synchronization.",
    "Participant contributions must reject overfunding and respect min_participants and target rules.",
    "Invoice lifecycle state transitions follow documented flows and are correctly reflected in UI and backend.",
    "Admin and owner authorization enforced by middleware on all protected API endpoints and UI routes.",
    "File uploads validated by MIME type and size limits; images stored securely in MinIO and accessible via API.",
    "Frontend components and pages implement expected user flows and show appropriate status badges and error messages.",
    "Automated backend tests cover API routes, business logic, and database transactions with isolation and rollback.",
    "Smart contract unit and integration tests verify escrow logic, edge cases, penalties, and event handling on testnet."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "React 19",
      "Vite",
      "TailwindCSS",
      "Zustand (state management)",
      "React Router v7",
      "TanStack React Query",
      "Node.js / Express (backend)",
      "PostgreSQL 16",
      "MinIO (S3-compatible storage)",
      "Stellar / Soroban (blockchain smart contracts)",
      "Freighter Wallet (SEP-0053 auth)",
      "JWT authentication",
      "Docker Compose",
      "Lucide React (icons)",
      "shadcn/ui components"
    ],
    "features": [
      {
        "name": "Wallet Authentication (Dev Mode)",
        "description": "Auto-login via VITE_DEV_WALLET env var or ?dev_wallet= URL param. Uses devLogin API endpoint that issues JWT without Freighter signature. Supports manual disconnect without auto-reconnect.",
        "files": [
          "frontend/src/hooks/useAuth.ts",
          "frontend/src/stores/walletStore.ts",
          "frontend/src/components/wallet/ConnectButton.tsx",
          "frontend/src/services/api.ts",
          "backend/src/controllers/authController.js",
          "backend/src/routes/auth.js"
        ]
      },
      {
        "name": "Invoice Dashboard",
        "description": "Lists all invoices for the authenticated user with status badges (draft, funding, completed, released, cancelled), amounts, participant counts, and navigation to detail pages.",
        "files": [
          "frontend/src/pages/InvoiceDashboard.tsx",
          "frontend/src/services/api.ts"
        ]
      },
      {
        "name": "Invoice Creation",
        "description": "Form to create group invoices with name, description, deadline, penalty settings, auto-release toggle, and line items (from service catalog or custom). Frontend validation: name required, deadline required and in future, at least one item, items must have description and positive amount.",
        "files": [
          "frontend/src/pages/CreateInvoice.tsx",
          "frontend/src/components/invoice/ServicePicker.tsx",
          "frontend/src/services/api.ts"
        ]
      },
      {
        "name": "Invoice Detail & On-Chain Actions",
        "description": "Shows invoice details with progress bar, participant list, and action panel. Actions vary by status: draft (link to blockchain, cancel), funding (join, contribute, withdraw, release, cancel, claim deadline), completed (confirm release, withdraw, organizer release), released/cancelled (read-only status messages). All on-chain actions build mock XDR in dev mode.",
        "files": [
          "frontend/src/pages/InvoiceDetail.tsx",
          "frontend/src/components/invoice/ProgressBar.tsx",
          "frontend/src/components/invoice/InvoiceItemsList.tsx",
          "frontend/src/components/invoice/ModificationBanner.tsx",
          "frontend/src/lib/soroban.ts",
          "frontend/src/services/api.ts"
        ]
      },
      {
        "name": "Soroban Transaction Builder (Mock)",
        "description": "Builds, simulates, and signs Soroban smart contract transactions. In DEV_MODE, returns mock XDR without hitting Soroban RPC or Freighter. Backend accepts mock XDR and returns simulated results.",
        "files": [
          "frontend/src/lib/soroban.ts",
          "backend/src/services/sorobanService.js"
        ]
      },
      {
        "name": "Service Catalog",
        "description": "Public page displaying all active services from registered businesses. Each card shows service name, description, price, and business name. Supports keyword search filtering.",
        "files": [
          "frontend/src/pages/ServiceCatalog.tsx",
          "frontend/src/services/api.ts"
        ]
      },
      {
        "name": "Business Management",
        "description": "CRUD operations for businesses owned by the authenticated user. Create, edit, view, and manage businesses. Each business has services, wallet address, and contact info.",
        "files": [
          "frontend/src/pages/MyBusinesses.tsx",
          "frontend/src/pages/RegisterBusiness.tsx",
          "frontend/src/pages/EditBusiness.tsx",
          "frontend/src/pages/BusinessProfile.tsx",
          "frontend/src/services/api.ts"
        ]
      },
      {
        "name": "Service Management",
        "description": "Add and edit services under a business. Each service has name, description, price, and optional image.",
        "files": [
          "frontend/src/pages/AddService.tsx",
          "frontend/src/pages/EditService.tsx",
          "frontend/src/services/api.ts"
        ]
      },
      {
        "name": "User Profile",
        "description": "Displays authenticated user's wallet address, username, role, and account creation date.",
        "files": [
          "frontend/src/pages/Profile.tsx",
          "frontend/src/services/api.ts"
        ]
      },
      {
        "name": "Admin Dashboard",
        "description": "Admin-only pages for platform management: user list with role modification, business overview, invoice management, and platform statistics.",
        "files": [
          "frontend/src/pages/admin/"
        ]
      },
      {
        "name": "Layout & Navigation",
        "description": "Header with navigation links that change based on auth state (public: Services; authenticated: Invoices, My Businesses; admin: Admin). Mobile hamburger menu. Landing page with hero section.",
        "files": [
          "frontend/src/components/layout/Header.tsx",
          "frontend/src/components/layout/Layout.tsx",
          "frontend/src/pages/Landing.tsx",
          "frontend/src/App.tsx"
        ]
      },
      {
        "name": "API Service Layer",
        "description": "Centralized API client with axios. All endpoints prefixed with /api. Includes auth interceptor for JWT, invoice CRUD, business CRUD, service CRUD, participant management, and blockchain link operations.",
        "files": [
          "frontend/src/services/api.ts"
        ]
      }
    ]
  }
}
